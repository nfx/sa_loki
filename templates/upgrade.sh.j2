#!/bin/bash

LOKI_VERSION="{{ loki_version }}"
cd {{ loki_base_dir }}
rm loki-linux-amd64.zip || true
wget  https://github.com/grafana/loki/releases/download/v${LOKI_VERSION}/loki-linux-amd64.zip
sudo service loki stop
unzip loki-linux-amd64.zip
sudo chown -R {{ loki_user }}:root {{ loki_base_dir }}/loki-linux-amd64
sudo chmod +x {{ loki_base_dir }}/loki-linux-amd64
#             Source                                  Link
sudo ln -f -s {{ loki_base_dir }}/loki-linux-amd64 {{ loki_base_dir }}/loki
sudo service loki start

# logcli
rm logcli-linux-amd64.zip || true
wget  https://github.com/grafana/loki/releases/download/v${LOKI_VERSION}/logcli-linux-amd64.zip
unzip logcli-linux-amd64.zip
sudo ln -f -s {{ loki_base_dir }}/logcli-linux-amd64 {{ loki_base_dir }}/logcli

# promtail
rm promtail-linux-amd64.zip || true
wget  https://github.com/grafana/loki/releases/download/v${LOKI_VERSION}/promtail-linux-amd64.zip
unzip promtail-linux-amd64.zip
sudo ln -f -s {{ loki_base_dir }}/promtail-linux-amd64 {{ loki_base_dir }}/promtail
